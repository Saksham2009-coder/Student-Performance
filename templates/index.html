<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Performance Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<button id="darkToggle" class="dark-btn">Dark Mode</button>

<div class="container">

    <div class="welcome-section">
        <h1>Welcome to Student Performance Analyzer</h1>
        <p>Track student marks, leaderboard & performance chart.</p>
    </div>

    <form class="form" action="/add" method="POST">
        <input type="text" name="name" placeholder="Name" required>
        <input type="number" name="physics" placeholder="Physics" required>
        <input type="number" name="chemistry" placeholder="Chemistry" required>
        <input type="number" name="math" placeholder="Math" required>
        <input type="number" name="cs" placeholder="CS" required>
        <input type="number" name="english" placeholder="English" required>

        <button type="submit" class="add-btn">Add / Update</button>
    </form>

    <form action="/clear" method="POST">
        <button class="clear-btn">Clear All (Keep Topper)</button>
    </form>

    <div class="main">
        <div class="table-box">
            <h2>Students</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Total</th>
                    <th>%</th>
                    <th>CGPA</th>
                    <th>Grade</th>
                </tr>

                {% for s in students %}
                <tr>
                    <td>{{ s.name }}</td>
                    <td>{{ s.total }}</td>
                    <td>{{ s.percentage|round(2) }}</td>
                    <td>{{ s.cgpa }}</td>
                    <td>{{ s.grade }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <div class="side">
            <div class="leaderboard">
                <h2>Leaderboard</h2>
                <ol>
                    {% for s in students %}
                        <li>{{ loop.index }}. {{ s.name }} - {{ s.percentage|round(2) }}%</li>
                    {% endfor %}
                </ol>
            </div>

            <div class="chart-box">
                <canvas id="chartCanvas"></canvas>
            </div>
        </div>

    </div>

</div>

<script>
const toggle = document.getElementById("darkToggle");
if(localStorage.getItem("dark") === "1"){
    document.body.classList.add("dark");
}
toggle.onclick = () => {
    document.body.classList.toggle("dark");
    localStorage.setItem("dark", document.body.classList.contains("dark") ? "1" : "0");
};

async function loadChart(){
    const res = await fetch("/data");
    const j = await res.json();
    const ctx = document.getElementById("chartCanvas").getContext("2d");

    new Chart(ctx,{
        type:"bar",
        data:{
            labels:j.labels,
            datasets:[{
                label:"Percentage",
                data:j.percentages,
                backgroundColor:"#60A5FA"
            }]
        }
    })
}
loadChart();
</script>

</body>
</html>
